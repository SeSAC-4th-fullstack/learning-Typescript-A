# chapter 11. 선언 파일

- TS는 구현과 별도로 타입 형태를 선언 가능
- 타입 선언은 파일이름이 .d.ts 확장자로 끝나는 선언파일에 작성됨
- 일반적으로 프로젝트 내에서 작성되고 프로젝트의 컴파일된 npm 패키지로 빌드 및 배포되거나 독립 실행형 `typings` 패키지로 공유됨

# 선언 파일

- `.d.ts` 선언파일은 런타임 코드를 포함할 수 없음
- 이외는 `.ts` 파일과 유사하게 작동
- `.d.ts` 파일에는 사용 가능한 런타임 값, 인터페이스, 모듈, 일반적인 타입의 설명만 포함
- `.d.ts` 파일은 JS로 컴파일 할 수 있는 모든 런타임 코드를 포함 불가
- 선언파일은 다른 TS 파일과 마찬가지로 import하여 사용 가능
- 선언파일은 값이 아닌 타입만 선언할 수 있는 코드 영역을 의미하는 앰비언트 컨텍스트를 생성

# 런타임 값 선언

- 선언파일은 함수 또는 변수 같은 런타임 값을 생성하지 않을 수 있지만, `declare` 키워드를 사용해 이러한 구조체가 존재한다고 선언 가능
  → 웹페이지의 `<script>` 태그 같은 일부 외부 작업이 특정 타입의 이름을 사용해 값을 생성했음을 타입 시스템에게 알림
- `declare`로 변수 선언 시 초깃값이 허용되지 않음
- 이외는 일반적인 변수 선언과 동일한 구문 사용
- 함수와 클래스도 일반적인 형식과 유사하게 선언되지만 함수 또는 메서드에 본문이 없음
- `declare`를 통한 타입 선언은 `.d.ts` 선언 파일에서 사용하는게 일반적이지만 외부에서도 사용 가능
- 모듈 도는 스크립트 파일에서 `declare` 사용 가능
- 전역으로 사용 간으한 변수가 해당 파일에서만 사용되어야 하는 경우 `declare` 키워드 유용

## 전역 변수

- `import` 또는 `export`문이 없는 TS 파일은 모듈이 아닌 스크립트로 취급되기에 선언된 타입을 포함한 구문은 전역으로 사용
- 전역 선언 파일은 애플리케이션의 모든 파일에 걸쳐 사용할 수 있는 전역 타입 또는 변수 선언 시 유용
- 전역으로 선언된 값은 전역 변수를 사용하는 브라우저 애플리케이션에 가장 자주 사용됨

## 전역 인터페이스 병합

- 인터페이스는 동일한 이름의 다른 인터페이스와 병합됨
  → `import`와 `export`문이 없는 `.d.ts` 선언 파일 같은 전역 스크립트 컨텍스트에서 인터페이스 선언 시 해당 인터페이스가 전역으로 확장됨

## 전역 확장

- 전역 범위로 확장이 필요한 `.d.ts` 파일에 `import` 또는 `export`문을 항상 금지 불가
  → 경우에 따라 모듈 파일에 선언된 타입이 전역으로 사용되어야 함
- 전역 선언과 모듈 선언이 함께 잘 작동하도록 랭글링 하는 것은 까다로울 수 있음
- TS의 `declare`와 `global` 키워드를 적절히 사용하여 프로젝트에서 전역으로 사용 가능한 타입 정의 설명 가능

# 내장된 선언

## 라이브버리 선언

- `lib` 파일은 TS npm 패키지의 일부로 배포되며 `node_modules/typescript/lib.es5.d.ts`와 같은 경로의 패키지 내부에서 찾을 수 있음

### 라이브러리 target

- 기본적으로 `tsc` CLI 또는 프로젝트의 `tsconfig.json`에서 제공된 `target` 설정에 따라 적절한 `lib` 파일을 포함함
- JS 최신 버전에 대한 연속적인 `lib` 파일들은 인터페이스 병합을 사용해 서로 빌드 됨
- TS 프로젝트는 target으로 지정한 JS 버전의 모든 최소 버전 `lib` 파일을 포함

## DOM 선언

- DOM 타입이라고 하는 웹 브라우저 타입은 `LocalStroage`와 같은 API와 웹 브라우저에서 주로 사용하는 `HTMLElement`와 같은 타입 형태를 다룸
- DOM 타입은 `lib.dom.d.ts`파일과 다른 `lib.*.d.ts` 선언 파일에도 저장됨
- `lib` 컴파일러 옵션을 재정의하지 않는 TS 프로젝트는 DOM 타입을 기본으로 포함함

# 모듈 선언

- 모듈의 문자열 이름 앞에 `declare` 키워드를 사용하면 모듈의 내용을 타입 시스템에 알릴 수 있음

## 와일드카드 모듈 선언

- 모듈 선언으로 하나의 `*` 와일드카드를 포함해 해당 패턴과 일치하는 모든 모듈을 나타낼 수 있음

# 패키지 타입

- TS로 작성된 프로젝트는 여전히 `.js`로 컴파일된 파일이 포함된 패키지를 배포
- 일반적으로 `.d.ts` 파일을 사용해 이러한 js 파일 뒤에 TS 타입 시스템 형태를 지원하도록 선언

## 선언

- TS는 입력된 파일에 대한 `.d.ts` 출력 파일과 JS 출력 파일을 함께 생성하는 선언 옵션을 제공
- 자동으로 생성된 `.d.ts` 파일은 프로젝트에서 사용자가 사용할 타입 정의를 생성하는 가장 좋은 방법
- 일반적으로 `.js` 파일을 생성하는 TS로 작성된 대부분의 패키지도 해당 파일과 함께 `.d.ts`를 번들로 묶는 것이 더 좋음

## 패키지 타입의 의존성

- TS는 프로젝트의 `node_modules` 의존성 내부에서 번들로 제공되는 `.d.ts` 파일을 감지하고 활용 가능
  → 해당 패키지에서 내보낸 타입 형태에 대해 마치 동일한 프로젝트에서 작성되었거나 선언 모듈 블록으로 선언된 것처럼 타입 시스템에 알림

## 패키지 타입 노출

- 프로젝트가 npm에 배포되고 사용자를 위한 타입을 제공하려면 패키지의 `package.json` 파일에 `types` 필드를 추가해 루트를 선언하고 파일을 가르킴
- `types` 필드는 `main` 필드와 유사하게 작동하고 동일한 것처럼 보이지만 `.js` 확장자 대신에 `.d.ts` 확장자 사용
- 대부분의 패키지는 TS의 선언 컴파일러 옵션을 사용해 소스 파일로부터 `.js` 파일과 함께 `.d.ts` 파일을 생성

# DefinitelyTyped(DT)

- TS 프로젝트는 해당 패키지에서 모듈의 타입 형태를 알려줘야 함
  → TS 팀과 커뮤티니는 커뮤니티에서 작성된 패키지 정의를 수용하기 위해 `DefinitelyTyped`라는 거대한 저장소를 만듦
- 저장소에는 변경 제안 검토 및 업데이트 게시와 관련된 자동화 부분과 수천개의 `.d.ts` 정의 패키지가 포함되어 있음
- DT 패키지는 타입을 제공하는 패키지와 동일한 이름으로 npm에 `@types` 범위로 게시됨

## 타입 사용 가능성

- 인기있는 JS 패키지는 자체 타이핑과 함께 제공되거나 `DefinitelyTyped`를 통해 타이핑 가능
- 아직 사용 가능한 타입이 없는 패키지에서 타입을 얻는 일반적인 세 가지 옵션
  1. `@types/` 패키지를 생성하기 위해 `DefinitelyTyped`에 풀 리퀘스트 보내기
  2. `declare module` 구문을 사용해 프로젝트 내에서 타입 작성
  3. `noImplicitAny` 옵션을 비활성화하기
